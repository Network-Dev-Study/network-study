# 링크 계층 스위치

스위치는 링크 계층 프레임을 수신해서 출력 링크로 전달한는 것이다.

스위치의 역할은 들어오는 링크 계층 프레임을 수신해서 출력 링크로 전달하는 것이다.

스위치는 그 자체가 서브넷의 호스트와 라우터들에게 투명하다.

즉, 호스트/라우터는 프레임을 스위치가 아닌 다른 호스트/라우터를 목적지로해서 랜상으로 보내며, 중간에 스위치가 프레임을 받아서 다른 노드에게 전달하는 것을 알지 못한다.

프레임이 스위치 출력 인터페이스들 중 하나에 도착하는 속도가 그 인터페이스의 링크 용량을 일시적으로 초과할 수 있다.

이 문제를 해결하기 위해, 스위치 출력 인터페이스는 버퍼를 갖고 있다.

### 포워딩과 필터링

**필터링**은 프레임을 인터페이스로 전달할지 또는 폐기할지 결정하는 스위치의 기능이다.

**포워딩**은 프레임이 전송될 인터페이스를 결정하고 프레임을 해당 인터페이스로 보내는 기능이다.

스위치의 필터링과 포워딩 둘 다 스위치 테이블을 이용한다.

스위치 테이블에는 랜상의 모든 호스트와 라우터는 아니지만 일부 노드에 대한 엔트리가 포함되어 있다.

스위치 테이블의 엔트리에는

1. MAC 주소
2. 그 MAC 주소로 가게 하는 스위치 인터페이스
3. 해당 엔트리가 테이블에 만들어진 시점에 대한 정보

이렇게 들어 있다.

이런 전달은 4장의 데이터그램 전달과 아주 유사하다.

스위치의 필터링 및 포워딩이 어떻게 동작하는 지 이해하기 위해

DD-DD-DD-DD-DD-DD(이하 D) 주소를 가진 프레임이 스위치에 인터페이스 x에 도착했다고 가정한다.

이렇다면 아래 3가지 경우가 가능하다.

1. 테이블에 D에 대한 엔트리가 없다

   이 경우 스위치는 프레임의 복사본을 인터페이스 x를 제외한 모든 인터페이스의 앞에 있는 출력 버퍼로 전달한다.

   즉, 목적지 주소에 대한 엔트리가 없으면 스위치는 프레임을 브로드캐스트한다.

2. 테이블에 D가 인터페이스 x에 연관된 엔트리가 있다.

   이 경우 프레임은 어댑터 D를 포함하는 랜 세그먼트로부터 왔다.

   이때는 프레임을 다른 인터페이스로 전달할 필요가 없으며, 프레임을 제거함으로써 필터링 기능을 수행한다.

3. 테이블에 목적지 주소가 y≠x 인터페이스와 연관된 엔트리가 있는 경우

   프레임은 y 인터페이스에 접속된 랜 세그먼트로 전달되어야 한다.

   즉, 해당 인터페이스 출력 버퍼에 프레임을 넣음으로써 포워딩 기능을 수행한다.

![](https://user-images.githubusercontent.com/76640167/214864184-93f04822-630e-4fb7-82e4-1453028bf915.png)

### 자가 학습

스위치는 테이블을 자동으로, 동적으로, 자치적으로 **자가학습(self-learning)**하는 특징이 있다.

**동작 과정**

1. 스위치 테이블은 초기에 비어있다.
2. 인터페이스로 수신한 각 프레임에 대해 스위치는 다음과 같은 정보를 저장한다.
   - 프레임의 출발지 주소 필드에 있는 MAC 주소
     즉, 다음번 수신 때 다른 랜에서 목적지 주소 필드를 해당 MAC 주소를 갖게되면 프레임을 알맞게 전달할 수 있게 된다.
   - 프레임이 도착한 인터페이스
   - 현재 시간
3. 랜에 있는 모든 호스트가 프레임을 송신하면, 결국 모든 호스트에 대한 정보가 테이블에 기록된다.

   `수명 시간(aging time)`이 지난 후에도 스위치가 해당 주소를 출발지 주소로 하는 프레임을 수신하지 못하면 테이블에서 이 주소를 삭제한다.

   즉, PC가 다른 PC로 대체되면 원래 PC의 MAC 주소는 스위치 테이블에서 삭제된다.

스위치는 네트워크 관리자나 사용자의 개입을 요구하지 않으므로 `플러그 앤 플레이 장치(plug-and-play device)`다.

### 링크 계층 스위치의 특성

- **충돌 제거**
  스위치로 구축된 랜에는 충돌로 인해 낭비되는 대역폭이 없다.
  프레임을 버퍼링하며 어느 시점이든 세그먼트에 하나 이상의 프레임을 전송하지 않는다.
  브로드캐스트 링크를 사용하는 랜보다 성능이 월등히 향상된다.
- **이질적인 링크들**
  링크들을 별개로 분리하기 때문에 랜의 각 링크는 상이한 속도로 동작할 수 있으며 상이한 매체를 사용할 수 있다.
- **관리**
  스위치는 향상된 보안을 제공할 뿐만 아니라 네트워크 관리를 쉽게 할 수 있게 한다.
  예를 들어 케이블이 끊긴다면 그쪽 호스트의 연결만 끊어진다, 오동작으로 프레임을 계속 보내는 경우 이 문제를 감지하고 오동작하는 어댑터의 연결을 의도적으로 끊는다.
  대역폭 사용, 충돌률, 트래픽 종류에 대한 통계치를 수집하여 볼 수 있다.

### 스위치 대 라우터

- 라우터
  - 네트워크 계층 주소를 사용해서 패킷을 전달하는 저장 후 전달 패킷 스위치다.
  - 3계층 패킷 스위치이다.
- 스위치
  - 저장후 전달 패킷 스위치이지만 MAC 주소를 사용해서 패킷을 전달한다.
  - 2계층 패킷 스위치이다.

이 둘은 근본적으로 다르지만(MAC 주소, IP 주소를 사용한다는 점에서), 네트워크 관리자는 상호연결 장치를 설치할 때 종종 이들 중에서 선택해야만 한다.

실제로, 라우터는 충돌 없이 학과 간의 통신이 가능하게 할 수 있다.

![](https://user-images.githubusercontent.com/76640167/214864160-537f30f6-bca5-4b5a-a30f-f00fab1c9b5a.png)

**스위치의 장점**

- `플러그 앤 플레이 장치(plug-and-play device)` 로 관리자가 크게 신경쓸 필요가 없다.
- 높은 패킷 필터링 및 전달률을 갖는다.

**스위치의 단점**

- 브로드캐스트 프레임의 순환을 방지하기 위해 스위치 네트워크의 실제 사용되는 토폴로지는 스패닝 트리로 제한된다.
- 대규모 스위치 네트워크에서는 호스트와 라우터가 커다란 ARP 테이블을 갖게 되며 상당한 양의 ARP 트래픽이 생성되고 처리된다.
- 브로드캐스트 트래픽의 폭주에 대비한 방안을 제공하지 않는다.

**라우터의 장점**

- 계층구조이므로, 네트워크에 중복된 경로가 있을 때 조차도 패킷은 라우터를 따라 순환하지 않는다. 즉, 스패닝 트리로 제한받지 않고 최상의 경로를 사용할 수 있다.
- 제한이 없으므로 인터넷 토폴로지가 자유롭게 구축될 수 있게 한다.
- 브로드캐스트 폭풍에 대비한 방화벽 보호기능이 있다.

**라우터의 단점**

- `플러그 앤 플레이 장치(plug-and-play device)` 가 아니다.
- 스위치보다 패킷당 처리 시간이 더 크다.

일반적으로, 작은 네트워크는 트래픽이 지역적으로 제한되어 있고 IP 주소의 구성을 요구하지 않으면서도 총 처리율을 증가시키므로 스위치로도 충분하다.

그러나 보통 수천 개의 호스트로 구성된 큰 네트워크에서는 라우터도 포함한다.

### 보안 초점: 스위치 랜을 훔쳐보기

목적지 주소가 스위치 테이블에 있는 경우, 호스트가 스위치에 연결되면 보통 자신을 목적지로 해서 전송된 프레임만 수신하기 때문에 다른 호스트는 프레임을 훔쳐볼 수 없다.

목적지 주소가 스위치 테이블에 없는 경우, 스위치가 프레임을 브로드캐스트하기 때문에 C의 스니퍼는 C를 목적지로 하지 않는 일부 프레임을 훔쳐볼 수 있다.

여기서 스위치 독(switch poisoning)은 여러가지 가짜 출발지 MAC주소를 갖는 패킷을 상당수 보내서 스위치 테이블을 가짜 엔트리로 가득 채워 합법적인 호스트들의 MAC주소를 넣을 공간을 없앤다.

그러나 이 공격은 공격자 입장에서 다소 어렵기 때문에 스위치 독으로부터는 안전하다.
